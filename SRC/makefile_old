

pre_flags_0 = ifort -O0
pre_flags   = ifort -O2 -xHost
#pre_flags   = ifort -O0

post_flags  = -L/opt/intel/compilers_and_libraries_2016.2.181/linux/bin/intel64/ -I/opt/intel/compilers_and_libraries_2016.2.181/linux/mkl/include -qopenmp -lpthread
final_flags = -L/opt/intel/compilers_and_libraries_2016.2.181/linux/mkl/lib/intel64/ -I/opt/intel/compilers_and_libraries_2016.2.181/linux/mkl/include -Wl,--start-group  ${MKLROOT}/lib/intel64/libmkl_intel_lp64.a ${MKLROOT}/lib/intel64/libmkl_intel_thread.a ${MKLROOT}/lib/intel64/libmkl_core.a -Wl,--end-group -qopenmp -lpthread

my_sources=$(wildcard *.f)
my_objects=$(my_sources:.f=.o)

other_objects = libxdrf.a 

treecode3d_final.o: treecode3d_final.f
	$(pre_flags) -c treecode3d_final.f $(post_flags)

uiowa_bd.modules.o:      uiowa_bd.modules.f
	$(pre_flags) -c uiowa_bd.modules.f $(post_flags) 

uiowa_bd.o:      uiowa_bd.f
	$(pre_flags) -c uiowa_bd.f $(post_flags) 

# the following should deal with all subroutine files here:
%.o: %.f 
	$(pre_flags) -c $*.f -o $*.o $(post_flags)

uiowa_bd: $(my_objects) $(other_objects)
	$(pre_flags) $(my_objects) $(other_objects) -o uiowa_bd.exe $(final_flags)

clean:
	rm *.mod
	rm *.o
